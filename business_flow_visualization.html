<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sasya Arogya - Business Flow Overview</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .diagram-container {
            padding: 40px;
            background: white;
            overflow-x: auto;
        }
        
        .mermaid {
            text-align: center;
            background: white;
        }
        
        .controls {
            padding: 20px 40px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
            text-align: center;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 24px;
            margin: 0 10px;
            background: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,123,255,0.3);
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #545b62;
        }
        
        .info-panel {
            padding: 30px 40px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
        }
        
        .flow-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .step-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #28a745;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .step-card h3 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            display: flex;
            align-items: center;
        }
        
        .step-number {
            background: #28a745;
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“± Business Flow Overview</h1>
            <p>High-Level User Journey & System Components</p>
        </div>
        
        <div class="diagram-container">
            <div class="mermaid">
flowchart TD
    %% Styling
    classDef userClass fill:#e3f2fd,stroke:#1976d2,stroke-width:3px,color:#000
    classDef appClass fill:#e8f5e8,stroke:#388e3c,stroke-width:3px,color:#000
    classDef gatewayClass fill:#fff3e0,stroke:#f57c00,stroke-width:3px,color:#000
    classDef aiClass fill:#f3e5f5,stroke:#7b1fa2,stroke-width:3px,color:#000
    classDef serviceClass fill:#fce4ec,stroke:#c2185b,stroke-width:3px,color:#000
    classDef outputClass fill:#e0f2f1,stroke:#00796b,stroke-width:3px,color:#000

    %% Layer 1: User Entry
    Farmer[ğŸ‘¨â€ğŸŒ¾ Farmer<br/>End User]
    
    %% Layer 2: Mobile Application
    AndroidApp[ğŸ“± Android App<br/>Mobile Interface]
    
    %% Layer 3: App Features (Horizontal)
    CameraCapture[ğŸ“· Camera Capture<br/>Disease Detection]
    ChatInterface[ğŸ’¬ Chat Interface<br/>Conversational AI]
    InsurancePortal[ğŸ›¡ï¸ Insurance Portal<br/>Claims & Policies]
    ProfileMgmt[ğŸ‘¤ Profile Management<br/>Agricultural Data]
    
    %% Layer 4: Gateway & Security
    APIGateway[ğŸšª API Gateway<br/>Request Routing]
    Authentication[ğŸ” Authentication<br/>User Security]
    
    %% Layer 5: Core AI Engine
    LangGraphAgent[ğŸ¤– LangGraph Agent<br/>Workflow Orchestration]
    
    %% Layer 6: Specialized Services (Horizontal)
    DiseaseDetection[ğŸ”¬ Disease Detection<br/>CNN Classification]
    PrescriptionRAG[ğŸ’Š Prescription RAG<br/>Treatment Recommendations]
    CropCareAI[ğŸŒ± Crop Care AI<br/>General Guidance]
    MCPInsurance[ğŸ›¡ï¸ MCP Insurance<br/>Claims Processing]
    
    %% Layer 7: External AI Services
    LLMServices[ğŸ¦™ LLM Services<br/>Ollama/LLaVA]
    VectorDB[ğŸ—ƒï¸ Vector Database<br/>Knowledge Retrieval]
    
    %% Layer 8: Results (Horizontal)
    DiagnosisResults[ğŸ” Diagnosis Results<br/>Disease Analysis]
    TreatmentPlan[ğŸ’Š Treatment Plan<br/>Prescriptions]
    CropAdvice[ğŸŒ¾ Crop Advice<br/>Best Practices]
    InsuranceClaim[ğŸ“‹ Insurance Claim<br/>Automated Processing]
    
    %% User Flow (Vertical Main Path)
    Farmer --> AndroidApp
    AndroidApp --> CameraCapture
    AndroidApp --> ChatInterface
    AndroidApp --> InsurancePortal
    AndroidApp --> ProfileMgmt
    
    %% Gateway Processing (Clean Convergence)
    CameraCapture --> APIGateway
    ChatInterface --> APIGateway
    InsurancePortal --> APIGateway
    ProfileMgmt --> APIGateway
    
    APIGateway --> Authentication
    Authentication --> LangGraphAgent
    
    %% AI Service Distribution (Clean Horizontal)
    LangGraphAgent --> DiseaseDetection
    LangGraphAgent --> PrescriptionRAG
    LangGraphAgent --> CropCareAI
    LangGraphAgent --> MCPInsurance
    
    %% External Service Integration (Minimal Connections)
    DiseaseDetection --> LLMServices
    PrescriptionRAG --> VectorDB
    PrescriptionRAG --> LLMServices
    CropCareAI --> LLMServices
    
    %% Result Generation (Clean Output)
    DiseaseDetection --> DiagnosisResults
    PrescriptionRAG --> TreatmentPlan
    CropCareAI --> CropAdvice
    MCPInsurance --> InsuranceClaim
    
    %% Results Back to User (Clean Return Path)
    DiagnosisResults --> ChatInterface
    TreatmentPlan --> ChatInterface
    CropAdvice --> ChatInterface
    InsuranceClaim --> InsurancePortal

    %% Apply Styles
    class Farmer userClass
    class AndroidApp appClass
    class CameraCapture,ChatInterface,InsurancePortal,ProfileMgmt appClass
    class APIGateway,Authentication gatewayClass
    class LangGraphAgent aiClass
    class DiseaseDetection,PrescriptionRAG,CropCareAI,MCPInsurance serviceClass
    class LLMServices,VectorDB serviceClass
    class DiagnosisResults,TreatmentPlan,CropAdvice,InsuranceClaim outputClass
            </div>
        </div>
        
        <div class="controls">
            <a href="#" class="btn" onclick="downloadSVG()">ğŸ“¥ Download SVG</a>
            <a href="#" class="btn" onclick="downloadPNG()">ğŸ“¸ Download PNG</a>
            <a href="https://mermaid.live/" target="_blank" class="btn btn-secondary">ğŸ”— Edit Online</a>
        </div>
        
        <div class="info-panel">
            <h2>ğŸ”„ Business Flow Steps</h2>
            <div class="flow-steps">
                <div class="step-card">
                    <h3><span class="step-number">1</span>User Interaction</h3>
                    <p>Farmer uses Android app to capture crop images, ask questions, or manage insurance through intuitive interfaces.</p>
                </div>
                
                <div class="step-card">
                    <h3><span class="step-number">2</span>Request Processing</h3>
                    <p>API Gateway routes requests through authentication and session management for secure processing.</p>
                </div>
                
                <div class="step-card">
                    <h3><span class="step-number">3</span>AI Orchestration</h3>
                    <p>LangGraph Agent determines the appropriate workflow: disease detection, prescription generation, or crop care advice.</p>
                </div>
                
                <div class="step-card">
                    <h3><span class="step-number">4</span>Specialized Processing</h3>
                    <p>Dedicated AI services process the request: CNN for disease detection, RAG for prescriptions, or MCP for insurance.</p>
                </div>
                
                <div class="step-card">
                    <h3><span class="step-number">5</span>Knowledge Integration</h3>
                    <p>External services provide LLM capabilities, vector search, and domain-specific knowledge for accurate responses.</p>
                </div>
                
                <div class="step-card">
                    <h3><span class="step-number">6</span>Result Delivery</h3>
                    <p>Processed results are delivered back to the user through the appropriate interface with actionable insights.</p>
                </div>
            </div>
            
            <h3>ğŸ¯ Key Business Outcomes</h3>
            <ul>
                <li><strong>ğŸ” Accurate Diagnosis:</strong> 85%+ accuracy in crop disease detection</li>
                <li><strong>ğŸ’Š Personalized Treatment:</strong> Context-aware prescription recommendations</li>
                <li><strong>ğŸ›¡ï¸ Insurance Automation:</strong> Streamlined claims and certificate processing</li>
                <li><strong>ğŸŒ± Continuous Support:</strong> 24/7 agricultural guidance and best practices</li>
                <li><strong>ğŸ“Š Data-Driven Insights:</strong> Historical analysis and predictive recommendations</li>
            </ul>
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true
            }
        });

        function downloadSVG() {
            const svg = document.querySelector('.mermaid svg');
            if (svg) {
                const svgData = new XMLSerializer().serializeToString(svg);
                const svgBlob = new Blob([svgData], {type: 'image/svg+xml;charset=utf-8'});
                const svgUrl = URL.createObjectURL(svgBlob);
                const downloadLink = document.createElement('a');
                downloadLink.href = svgUrl;
                downloadLink.download = 'sasya-arogya-business-flow.svg';
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
            }
        }

        function downloadPNG() {
            const diagramContainer = document.querySelector('.mermaid');
            if (!diagramContainer) {
                alert('No diagram found to download');
                return;
            }

            // Show loading message
            const originalText = document.querySelector('.btn').textContent;
            const pngButton = Array.from(document.querySelectorAll('.btn')).find(btn => btn.textContent.includes('PNG'));
            if (pngButton) {
                pngButton.textContent = 'â³ Generating PNG...';
                pngButton.style.pointerEvents = 'none';
            }

            html2canvas(diagramContainer, {
                backgroundColor: '#ffffff',
                scale: 2,
                useCORS: true,
                allowTaint: true,
                foreignObjectRendering: true,
                logging: false,
                width: diagramContainer.scrollWidth,
                height: diagramContainer.scrollHeight
            }).then(canvas => {
                // Create download link
                canvas.toBlob(function(blob) {
                    const url = URL.createObjectURL(blob);
                    const downloadLink = document.createElement('a');
                    downloadLink.href = url;
                    downloadLink.download = 'sasya-arogya-business-flow.png';
                    document.body.appendChild(downloadLink);
                    downloadLink.click();
                    document.body.removeChild(downloadLink);
                    URL.revokeObjectURL(url);
                    
                    // Reset button
                    if (pngButton) {
                        pngButton.textContent = 'ğŸ“¸ Download PNG';
                        pngButton.style.pointerEvents = 'auto';
                    }
                }, 'image/png', 1.0);
            }).catch(error => {
                console.error('Error generating PNG:', error);
                alert('Error generating PNG. The diagram might be too complex. Please try downloading as SVG instead.');
                
                // Reset button
                if (pngButton) {
                    pngButton.textContent = 'ğŸ“¸ Download PNG';
                    pngButton.style.pointerEvents = 'auto';
                }
            });
        }
    </script>
</body>
</html>