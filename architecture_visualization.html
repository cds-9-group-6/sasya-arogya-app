<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sasya Arogya - Architecture Visualization</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .diagram-container {
            padding: 40px;
            background: white;
            overflow-x: auto;
        }
        
        .mermaid {
            text-align: center;
            background: white;
        }
        
        .controls {
            padding: 20px 40px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
            text-align: center;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 24px;
            margin: 0 10px;
            background: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,123,255,0.3);
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #545b62;
        }
        
        .info-panel {
            padding: 30px 40px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .info-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #007bff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .info-card h3 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }
        
        .info-card ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .info-card li {
            margin: 5px 0;
            color: #555;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .diagram-container {
                padding: 20px;
            }
            
            .controls {
                padding: 15px 20px;
            }
            
            .btn {
                display: block;
                margin: 10px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒ¾ Sasya Arogya Architecture</h1>
            <p>Comprehensive AI-Powered Agricultural System Architecture</p>
        </div>
        
        <div class="diagram-container">
            <div class="mermaid">
graph TB
    %% Styling
    classDef uiClass fill:#e1f5fe,stroke:#01579b,stroke-width:2px,color:#000
    classDef agentClass fill:#f3e5f5,stroke:#4a148c,stroke-width:2px,color:#000
    classDef mlClass fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px,color:#000
    classDef ragClass fill:#fff3e0,stroke:#e65100,stroke-width:2px,color:#000
    classDef mcpClass fill:#fce4ec,stroke:#880e4f,stroke-width:2px,color:#000
    classDef llmClass fill:#f1f8e9,stroke:#33691e,stroke-width:2px,color:#000
    classDef dataClass fill:#f5f5f5,stroke:#424242,stroke-width:2px,color:#000
    classDef infraClass fill:#e3f2fd,stroke:#0d47a1,stroke-width:2px,color:#000

    %% UI Layer
    subgraph UI["ğŸ¨ User Interface Layer"]
        direction TB
        AndroidApp["ğŸ“± Android App<br/>(Kotlin/Java)"]
        ChatUI["ğŸ’¬ Chat Interface<br/>(FSM-driven)"]
        CameraUI["ğŸ“· Camera Capture<br/>(Disease Detection)"]
        InsuranceUI["ğŸ›¡ï¸ Insurance Portal<br/>(Claims & Certificates)"]
        ProfileUI["ğŸ‘¤ Agricultural Profile<br/>(Crop & Location Data)"]
    end

    %% API Gateway & Load Balancer
    subgraph Gateway["ğŸŒ API Gateway Layer"]
        LoadBalancer["âš–ï¸ Load Balancer<br/>(NGINX/HAProxy)"]
        APIGateway["ğŸšª API Gateway<br/>(FastAPI Router)"]
        AuthService["ğŸ” Authentication<br/>(JWT/OAuth)"]
        RateLimit["ğŸš¦ Rate Limiting<br/>(Redis-based)"]
    end

    %% Core Agent System
    subgraph Agent["ğŸ¤– LangGraph FSM Agent Core"]
        direction TB
        
        %% State Machine
        subgraph StateMachine["ğŸ”„ State Machine Transitions"]
            InitState["ğŸ Initial State<br/>(Welcome)"]
            IntentState["ğŸ¯ Intent Analysis<br/>(Classification)"]
            DiseaseState["ğŸ¦  Disease Detection<br/>(Image Processing)"]
            PrescriptionState["ğŸ’Š Prescription<br/>(RAG-based)"]
            InsuranceState["ğŸ›¡ï¸ Insurance<br/>(MCP Integration)"]
            CropCareState["ğŸŒ± General Crop Care<br/>(Knowledge Base)"]
            FinalState["âœ… Response Generation<br/>(LLM Synthesis)"]
        end
        
        %% Agent Components
        AgentOrchestrator["ğŸ¼ Agent Orchestrator<br/>(LangGraph)"]
        ContextManager["ğŸ“‹ Context Manager<br/>(Session State)"]
        WorkflowEngine["âš™ï¸ Workflow Engine<br/>(Node Execution)"]
    end

    %% ML/AI Processing Layer
    subgraph ML["ğŸ§  ML/AI Processing Layer"]
        direction TB
        
        %% CNN Classification
        subgraph CNN["ğŸ”¬ CNN Disease Classification"]
            ImagePreprocess["ğŸ–¼ï¸ Image Preprocessing<br/>(Resize, Normalize)"]
            CNNModel["ğŸ§¬ CNN Model<br/>(ResNet/EfficientNet)"]
            ConfidenceScore["ğŸ“Š Confidence Scoring<br/>(Threshold: 85%)"]
        end
        
        %% LLM Services
        subgraph LLM["ğŸ§  LLM Services"]
            OllamaService["ğŸ¦™ Ollama Service<br/>(Llama 3.1 8B)"]
            LlavaVision["ğŸ‘ï¸ LLaVA Vision<br/>(Multimodal Analysis)"]
            EmbeddingService["ğŸ”¤ Embedding Service<br/>(Text Vectorization)"]
        end
    end

    %% RAG System
    subgraph RAG["ğŸ“š Prescription RAG System"]
        direction TB
        VectorDB["ğŸ—ƒï¸ Vector Database<br/>(ChromaDB)"]
        KnowledgeBase["ğŸ“– Knowledge Base<br/>(Agricultural Prescriptions)"]
        Retriever["ğŸ” Document Retriever<br/>(Similarity Search)"]
        Generator["âœï¸ Response Generator<br/>(Context-aware)"]
    end

    %% MCP Insurance System
    subgraph MCP["ğŸ›¡ï¸ MCP Insurance Server"]
        direction TB
        MCPServer["ğŸ–¥ï¸ MCP Server<br/>(Insurance Integration)"]
        ClaimsProcessor["ğŸ“‹ Claims Processor<br/>(Automated Assessment)"]
        CertificateGen["ğŸ“œ Certificate Generator<br/>(PDF/Digital)"]
        InsuranceDB["ğŸ—„ï¸ Insurance Database<br/>(Policies & Claims)"]
    end

    %% Data & Storage Layer
    subgraph Data["ğŸ’¾ Data & Storage Layer"]
        direction TB
        PostgresDB["ğŸ˜ PostgreSQL<br/>(User Data & Sessions)"]
        RedisCache["âš¡ Redis Cache<br/>(Session & Rate Limiting)"]
        S3Storage["â˜ï¸ Object Storage<br/>(Images & Documents)"]
        MLflowTracking["ğŸ“ˆ MLflow Tracking<br/>(Model Versioning)"]
    end

    %% Monitoring & Observability
    subgraph Monitoring["ğŸ“Š Monitoring & Observability"]
        direction TB
        Prometheus["ğŸ“Š Prometheus<br/>(Metrics Collection)"]
        Grafana["ğŸ“ˆ Grafana<br/>(Dashboards)"]
        Jaeger["ğŸ” Jaeger<br/>(Distributed Tracing)"]
        AlertManager["ğŸš¨ Alert Manager<br/>(Notifications)"]
    end

    %% Infrastructure Layer
    subgraph Infrastructure["ğŸ—ï¸ Infrastructure Layer"]
        direction TB
        
        subgraph Clusters["â˜ï¸ OpenShift Clusters"]
            GPUCluster["ğŸš€ GPU Cluster<br/>(engine-sasya-chikitsa)<br/>cluster-mqklc.sandbox601"]
            NonGPUCluster["âš¡ Non-GPU Cluster<br/>(engine-sasya-arogya)<br/>cluster-dg9gp.sandbox1039"]
        end
        
        Docker["ğŸ³ Docker<br/>(Containerization)"]
        Kubernetes["â˜¸ï¸ Kubernetes<br/>(Orchestration)"]
    end

    %% Connections - UI to Gateway
    AndroidApp --> LoadBalancer
    ChatUI --> APIGateway
    CameraUI --> APIGateway
    InsuranceUI --> APIGateway
    ProfileUI --> APIGateway

    %% Gateway Layer Connections
    LoadBalancer --> APIGateway
    APIGateway --> AuthService
    APIGateway --> RateLimit
    APIGateway --> AgentOrchestrator

    %% Agent State Machine Flow
    AgentOrchestrator --> InitState
    InitState --> IntentState
    IntentState --> DiseaseState
    IntentState --> CropCareState
    IntentState --> InsuranceState
    DiseaseState --> PrescriptionState
    PrescriptionState --> FinalState
    CropCareState --> FinalState
    InsuranceState --> FinalState
    
    %% Agent Internal Connections
    AgentOrchestrator --> ContextManager
    AgentOrchestrator --> WorkflowEngine
    ContextManager --> RedisCache

    %% ML Processing Connections
    DiseaseState --> ImagePreprocess
    ImagePreprocess --> CNNModel
    CNNModel --> ConfidenceScore
    ConfidenceScore --> LlavaVision
    
    %% LLM Service Connections
    AgentOrchestrator --> OllamaService
    FinalState --> OllamaService
    IntentState --> EmbeddingService

    %% RAG System Connections
    PrescriptionState --> Retriever
    Retriever --> VectorDB
    VectorDB --> KnowledgeBase
    Retriever --> Generator
    Generator --> OllamaService

    %% MCP Insurance Connections
    InsuranceState --> MCPServer
    MCPServer --> ClaimsProcessor
    MCPServer --> CertificateGen
    ClaimsProcessor --> InsuranceDB
    CertificateGen --> S3Storage

    %% Data Layer Connections
    ContextManager --> PostgresDB
    AgentOrchestrator --> RedisCache
    CNNModel --> MLflowTracking
    S3Storage --> CameraUI

    %% Monitoring Connections
    AgentOrchestrator -.-> Prometheus
    APIGateway -.-> Prometheus
    CNNModel -.-> Prometheus
    MCPServer -.-> Prometheus
    Prometheus --> Grafana
    AgentOrchestrator -.-> Jaeger
    Jaeger --> Grafana
    Prometheus --> AlertManager

    %% Infrastructure Connections
    AgentOrchestrator --> GPUCluster
    CNNModel --> GPUCluster
    MCPServer --> NonGPUCluster
    RAG --> NonGPUCluster
    
    Docker --> Kubernetes
    Kubernetes --> GPUCluster
    Kubernetes --> NonGPUCluster

    %% Apply Styles
    class AndroidApp,ChatUI,CameraUI,InsuranceUI,ProfileUI uiClass
    class AgentOrchestrator,ContextManager,WorkflowEngine,InitState,IntentState,DiseaseState,PrescriptionState,InsuranceState,CropCareState,FinalState agentClass
    class ImagePreprocess,CNNModel,ConfidenceScore,OllamaService,LlavaVision,EmbeddingService mlClass
    class VectorDB,KnowledgeBase,Retriever,Generator ragClass
    class MCPServer,ClaimsProcessor,CertificateGen,InsuranceDB mcpClass
    class PostgresDB,RedisCache,S3Storage,MLflowTracking dataClass
    class LoadBalancer,APIGateway,AuthService,RateLimit,Docker,Kubernetes,GPUCluster,NonGPUCluster infraClass
            </div>
        </div>
        
        <div class="controls">
            <a href="#" class="btn" onclick="downloadSVG()">ğŸ“¥ Download SVG</a>
            <a href="#" class="btn" onclick="downloadPNG()">ğŸ“¸ Download PNG</a>
            <a href="https://mermaid.live/" target="_blank" class="btn btn-secondary">ğŸ”— Edit Online</a>
            <a href="#" class="btn btn-secondary" onclick="toggleFullscreen()">ğŸ” Fullscreen</a>
        </div>
        
        <div class="info-panel">
            <h2>ğŸ—ï¸ Architecture Overview</h2>
            <div class="info-grid">
                <div class="info-card">
                    <h3>ğŸ¨ UI Components</h3>
                    <ul>
                        <li>Android App (Kotlin/Java)</li>
                        <li>FSM-driven Chat Interface</li>
                        <li>Camera Disease Detection</li>
                        <li>Insurance Management Portal</li>
                        <li>Agricultural Profile System</li>
                    </ul>
                </div>
                
                <div class="info-card">
                    <h3>ğŸ¤– LangGraph Agent</h3>
                    <ul>
                        <li>State Machine Transitions</li>
                        <li>Intent Analysis & Classification</li>
                        <li>Workflow Orchestration</li>
                        <li>Context Management</li>
                        <li>Session State Handling</li>
                    </ul>
                </div>
                
                <div class="info-card">
                    <h3>ğŸ§  ML/AI Processing</h3>
                    <ul>
                        <li>CNN Disease Classification</li>
                        <li>Ollama LLM Service (Llama 3.1)</li>
                        <li>LLaVA Multimodal Vision</li>
                        <li>Embedding & Vectorization</li>
                        <li>85% Confidence Threshold</li>
                    </ul>
                </div>
                
                <div class="info-card">
                    <h3>ğŸ“š RAG System</h3>
                    <ul>
                        <li>ChromaDB Vector Database</li>
                        <li>Agricultural Knowledge Base</li>
                        <li>Similarity-based Retrieval</li>
                        <li>Context-aware Generation</li>
                        <li>Prescription Recommendations</li>
                    </ul>
                </div>
                
                <div class="info-card">
                    <h3>ğŸ›¡ï¸ MCP Insurance</h3>
                    <ul>
                        <li>Automated Claims Processing</li>
                        <li>Digital Certificate Generation</li>
                        <li>Policy Management</li>
                        <li>External Provider Integration</li>
                        <li>Document Management</li>
                    </ul>
                </div>
                
                <div class="info-card">
                    <h3>ğŸš€ Infrastructure</h3>
                    <ul>
                        <li>GPU Cluster (engine-sasya-chikitsa)</li>
                        <li>Non-GPU Cluster (engine-sasya-arogya)</li>
                        <li>OpenShift Container Platform</li>
                        <li>Docker & Kubernetes</li>
                        <li>Comprehensive Monitoring</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Mermaid
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true
            }
        });

        // Download functions
        function downloadSVG() {
            const svg = document.querySelector('.mermaid svg');
            if (svg) {
                const svgData = new XMLSerializer().serializeToString(svg);
                const svgBlob = new Blob([svgData], {type: 'image/svg+xml;charset=utf-8'});
                const svgUrl = URL.createObjectURL(svgBlob);
                const downloadLink = document.createElement('a');
                downloadLink.href = svgUrl;
                downloadLink.download = 'sasya-arogya-architecture.svg';
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
            }
        }

        function downloadPNG() {
            const svg = document.querySelector('.mermaid svg');
            if (svg) {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const data = new XMLSerializer().serializeToString(svg);
                const DOMURL = window.URL || window.webkitURL || window;
                const img = new Image();
                const svgBlob = new Blob([data], {type: 'image/svg+xml;charset=utf-8'});
                const url = DOMURL.createObjectURL(svgBlob);
                
                img.onload = function() {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);
                    DOMURL.revokeObjectURL(url);
                    
                    const imgURI = canvas.toDataURL('image/png').replace('image/png', 'image/octet-stream');
                    const downloadLink = document.createElement('a');
                    downloadLink.href = imgURI;
                    downloadLink.download = 'sasya-arogya-architecture.png';
                    document.body.appendChild(downloadLink);
                    downloadLink.click();
                    document.body.removeChild(downloadLink);
                };
                
                img.src = url;
            }
        }

        function toggleFullscreen() {
            const container = document.querySelector('.container');
            if (!document.fullscreenElement) {
                container.requestFullscreen().catch(err => {
                    alert(`Error attempting to enable fullscreen: ${err.message}`);
                });
            } else {
                document.exitFullscreen();
            }
        }

        // Responsive handling
        window.addEventListener('resize', function() {
            mermaid.init();
        });
    </script>
</body>
</html>


